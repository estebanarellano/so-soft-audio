<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greeting Practice App</title>
    <style>
        :root {
            --background: #ffffff;
            --foreground: oklch(0.145 0 0);
            --card: #ffffff;
            --card-foreground: oklch(0.145 0 0);
            --primary: #030213;
            --primary-foreground: oklch(1 0 0);
            --secondary: oklch(0.95 0.0058 264.53);
            --secondary-foreground: #030213;
            --muted: #ececf0;
            --muted-foreground: #717182;
            --accent: #e9ebef;
            --border: rgba(0, 0, 0, 0.1);
            --input-background: #f3f3f5;
            --radius: 0.625rem;
        }

        .dark {
            --background: oklch(0.145 0 0);
            --foreground: oklch(0.985 0 0);
            --card: oklch(0.145 0 0);
            --card-foreground: oklch(0.985 0 0);
            --primary: oklch(0.985 0 0);
            --primary-foreground: oklch(0.205 0 0);
            --secondary: oklch(0.269 0 0);
            --secondary-foreground: oklch(0.985 0 0);
            --muted: oklch(0.269 0 0);
            --muted-foreground: oklch(0.708 0 0);
            --accent: oklch(0.269 0 0);
            --border: oklch(0.269 0 0);
            --input-background: oklch(0.269 0 0);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: var(--foreground);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            width: 90%;
            max-width: 600px;
            background: var(--card);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--secondary);
            color: var(--secondary-foreground);
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: opacity 0.2s;
        }

        .theme-toggle:hover {
            opacity: 0.8;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 2em;
            margin-bottom: 16px;
            text-align: center;
            font-weight: 500;
            color: var(--foreground);
        }

        p {
            font-size: 1rem;
            margin-bottom: 24px;
            text-align: center;
            line-height: 1.5;
            color: var(--muted-foreground);
        }

        .btn {
            background: var(--primary);
            color: var(--primary-foreground);
            border: none;
            padding: 12px 32px;
            font-size: 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: block;
            margin: 0 auto;
            transition: opacity 0.2s;
            font-weight: 500;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:active {
            opacity: 0.8;
        }

        .interaction-area {
            text-align: center;
            margin: 40px 0;
        }

        .morph-button {
            background: var(--primary);
            color: var(--primary-foreground);
            border: none;
            padding: 16px 48px;
            font-size: 1.1rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.5s ease;
            font-weight: 500;
        }

        .morph-button.morphing {
            width: 100%;
            border-radius: var(--radius);
            padding: 12px;
            cursor: default;
            background: var(--secondary);
            color: var(--secondary-foreground);
        }

        .slider-container {
            display: none;
            margin-top: 20px;
        }

        .slider-container.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: var(--radius);
            background: var(--muted);
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid var(--background);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid var(--background);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .slider-label {
            font-size: 1.3em;
            font-weight: 500;
            margin: 20px 0;
            color: var(--foreground);
        }

        .text-display {
            min-height: 120px;
            font-size: 1.2em;
            text-align: center;
            margin: 30px 0;
            line-height: 1.6;
            color: var(--foreground);
        }

        .text-display.typing {
            border-right: 2px solid var(--foreground);
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 100% { border-color: var(--foreground); }
            50% { border-color: transparent; }
        }

        .survey-form {
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--foreground);
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            font-size: 1rem;
            font-family: inherit;
            background: var(--input-background);
            color: var(--foreground);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 400;
        }

        .radio-group input[type="radio"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .loading-indicator {
            text-align: center;
            color: var(--muted-foreground);
            margin-top: 20px;
            font-style: italic;
        }

        .emoji-scale {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .emoji-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: var(--radius);
            transition: background 0.2s;
        }

        .emoji-option:hover {
            background: var(--muted);
        }

        .emoji-option input[type="radio"] {
            display: none;
        }

        .emoji-option .emoji {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .emoji-option input[type="radio"]:checked + .emoji {
            transform: scale(1.3);
            transition: transform 0.2s;
        }

        .emoji-option .label {
            font-size: 0.85em;
            color: var(--muted-foreground);
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
    
    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="screen active">
            <h1>👋 Greeting Practice</h1>
            <p>This tool helps you practice the timing of street greetings. Select how far away someone is, and audio prompts will guide you through the encounter.</p>
            <button class="btn" onclick="startExperience()">Start Practice</button>
        </div>

        <!-- Selection Screen -->
        <div id="selectionScreen" class="screen">
            <h1>How Far Away?</h1>
            <p>Tap below and select the distance to the person approaching</p>
            <div class="interaction-area">
                <button id="morphButton" class="morph-button" onclick="morphToSlider()">
                    I See Someone
                </button>
                <div id="sliderContainer" class="slider-container">
                    <div class="slider-label" id="sliderLabel">Close (5-15 feet)</div>
                    <input type="range" id="audioSlider" min="1" max="3" value="1" step="1">
                    <button class="btn" onclick="playExperience()">Start Guidance</button>
                </div>
            </div>
        </div>

        <!-- Experience Screen -->
        <div id="experienceScreen" class="screen">
            <h1>You've Got This</h1>
            <div class="text-display" id="textDisplay"></div>
            <div class="loading-indicator" id="loadingIndicator" style="display: none;">
                Loading audio...
            </div>
        </div>

        <!-- Survey Screen -->
        <div id="surveyScreen" class="screen">
            <h1>How Did It Go?</h1>
            <p>Help us understand your experience</p>
            <form class="survey-form" id="surveyForm" onsubmit="submitSurvey(event)">
                <input type="hidden" id="distance" name="distance">
                <input type="hidden" id="timestamp" name="timestamp">
                
                <div class="form-group">
                    <label>Did you greet them?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="you_greeted" value="yes" required> Yes</label>
                        <label><input type="radio" name="you_greeted" value="no"> No</label>
                        <label><input type="radio" name="you_greeted" value="sort-of"> Sort of</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Did they greet you back?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="they_greeted" value="yes" required> Yes</label>
                        <label><input type="radio" name="they_greeted" value="no"> No</label>
                        <label><input type="radio" name="they_greeted" value="sort-of"> Sort of</label>
                        <label><input type="radio" name="they_greeted" value="na"> Didn't greet</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>How did the encounter feel?</label>
                    <div class="emoji-scale">
                        <label class="emoji-option">
                            <input type="radio" name="feeling" value="1" required>
                            <span class="emoji">😰</span>
                            <span class="label">Very awkward</span>
                        </label>
                        <label class="emoji-option">
                            <input type="radio" name="feeling" value="2">
                            <span class="emoji">😐</span>
                            <span class="label">Awkward</span>
                        </label>
                        <label class="emoji-option">
                            <input type="radio" name="feeling" value="3">
                            <span class="emoji">🙂</span>
                            <span class="label">Neutral</span>
                        </label>
                        <label class="emoji-option">
                            <input type="radio" name="feeling" value="4">
                            <span class="emoji">😊</span>
                            <span class="label">Natural</span>
                        </label>
                        <label class="emoji-option">
                            <input type="radio" name="feeling" value="5">
                            <span class="emoji">🌟</span>
                            <span class="label">Very natural</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Was the audio timing helpful?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="timing_helpful" value="yes" required> Yes</label>
                        <label><input type="radio" name="timing_helpful" value="no"> No</label>
                        <label><input type="radio" name="timing_helpful" value="somewhat"> Somewhat</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Would you use this again?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="use_again" value="yes" required> Yes</label>
                        <label><input type="radio" name="use_again" value="no"> No</label>
                        <label><input type="radio" name="use_again" value="maybe"> Maybe</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>What happened? (Optional)</label>
                    <textarea name="description" placeholder="Describe the encounter..."></textarea>
                </div>

                <button type="submit" class="btn">Submit Feedback</button>
                <div id="submitStatus" style="text-align: center; margin-top: 15px; color: var(--muted-foreground);"></div>
            </form>
        </div>
    </div>

    <script>
        // ===== GOOGLE SHEETS CONFIGURATION =====
        // REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_SCRIPT_URL_HERE';
        
        // Audio files configuration - REPLACE THESE URLs WITH YOUR OWN
        const audioFiles = {
            1: 'audio/close.mp3',   // Close distance (5-15 feet)
            2: 'audio/medium.mp3',  // Medium distance (15-30 feet)
            3: 'audio/far.mp3'      // Far distance (30+ feet)
        };

        const sliderOptions = [
            'Close (5-15 feet)', 
            'Medium (15-30 feet)', 
            'Far (30+ feet)'
        ];
        
        let currentAudio = null;
        let selectedDistance = 1;
        
        const experiences = {
            1: {
                text: "Take a breath. You're capable of this moment of connection. They're getting close—if you want to, make eye contact. You've got this. A simple 'hi' is enough. However it goes, you showed up."
            },
            2: {
                text: "Someone's approaching. You have time. Remember—most people appreciate a friendly greeting. Notice their body language. When it feels right, a smile or a simple hello works perfectly. Trust yourself."
            },
            3: {
                text: "You've spotted someone in the distance. This is your moment to prepare. Connection starts with small gestures. As they get closer, you'll know what feels right. There's no wrong way to be friendly. You're ready for this."
            }
        };

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startExperience() {
            showScreen('selectionScreen');
        }

        function morphToSlider() {
            const button = document.getElementById('morphButton');
            const slider = document.getElementById('sliderContainer');
            
            button.classList.add('morphing');
            button.textContent = 'Select Distance';
            button.style.pointerEvents = 'none';
            
            setTimeout(() => {
                slider.classList.add('active');
            }, 300);
        }

        // Update slider label
        document.getElementById('audioSlider').addEventListener('input', function(e) {
            const label = document.getElementById('sliderLabel');
            label.textContent = sliderOptions[e.target.value - 1];
        });

        function typeText(text, element, speed = 50) {
            element.textContent = '';
            element.classList.add('typing');
            let i = 0;
            
            return new Promise((resolve) => {
                const interval = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(interval);
                        element.classList.remove('typing');
                        resolve();
                    }
                }, speed);
            });
        }

        async function playExperience() {
            const sliderValue = document.getElementById('audioSlider').value;
            selectedDistance = sliderValue;
            const experience = experiences[sliderValue];
            const audioUrl = audioFiles[sliderValue];
            
            showScreen('experienceScreen');
            
            const textDisplay = document.getElementById('textDisplay');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            // Stop any currently playing audio
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            // Create new audio element
            currentAudio = new Audio(audioUrl);
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            
            // Wait for audio to be ready
            currentAudio.addEventListener('canplaythrough', async () => {
                loadingIndicator.style.display = 'none';
                
                // Play audio
                try {
                    await currentAudio.play();
                } catch (error) {
                    console.log('Audio playback failed:', error);
                }
                
                // Type text while audio plays
                await typeText(experience.text, textDisplay);
                
                // Wait for audio to finish or wait a bit longer
                const remainingTime = (currentAudio.duration - currentAudio.currentTime) * 1000;
                setTimeout(() => {
                    showScreen('surveyScreen');
                }, Math.max(remainingTime, 1500));
            }, { once: true });
            
            // Handle loading errors
            currentAudio.addEventListener('error', () => {
                loadingIndicator.textContent = 'Audio file not found. Continuing without audio...';
                // Continue anyway after a delay
                setTimeout(async () => {
                    loadingIndicator.style.display = 'none';
                    await typeText(experience.text, textDisplay);
                    setTimeout(() => {
                        showScreen('surveyScreen');
                    }, 2000);
                }, 2000);
            });
            
            // Start loading the audio
            currentAudio.load();
        }

        async function submitSurvey(event) {
            event.preventDefault();
            
            const form = event.target;
            const submitButton = form.querySelector('button[type="submit"]');
            const statusDiv = document.getElementById('submitStatus');
            
            // Disable submit button
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            statusDiv.textContent = 'Sending your feedback...';
            
            // Collect form data
            const formData = new FormData(form);
            
            // Add hidden fields
            formData.set('distance', sliderOptions[selectedDistance - 1]);
            formData.set('timestamp', new Date().toISOString());
            
            // Convert to object for Google Sheets
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            try {
                // Send to Google Sheets
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                // With no-cors mode, we can't read the response, so just assume success
                statusDiv.textContent = 'Thank you! Your feedback has been recorded.';
                statusDiv.style.color = 'green';
                
                // Stop any playing audio
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                // Wait a moment, then reset
                setTimeout(() => {
                    // Reset form
                    form.reset();
                    
                    // Reset UI
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Feedback';
                    statusDiv.textContent = '';
                    
                    // Reset slider
                    document.getElementById('morphButton').classList.remove('morphing');
                    document.getElementById('morphButton').textContent = 'I See Someone';
                    document.getElementById('morphButton').style.pointerEvents = 'auto';
                    document.getElementById('sliderContainer').classList.remove('active');
                    document.getElementById('audioSlider').value = 1;
                    document.getElementById('sliderLabel').textContent = 'Close (5-15 feet)';
                    
                    // Return to welcome screen
                    showScreen('welcomeScreen');
                }, 2000);
                
            } catch (error) {
                console.error('Error submitting form:', error);
                statusDiv.textContent = 'Error submitting. Your data has been logged locally.';
                statusDiv.style.color = 'red';
                
                // Log to console as backup
                console.log('Survey Data:', data);
                
                // Re-enable button
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Feedback';
            }
        }
    </script>
</body>
</html>
